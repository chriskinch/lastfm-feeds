/*!
 * lastfmfeeds v0.1.0 - Last FM Feed JS
 * https://github.com/chriskinch/lastfm_widget
 */
!function(a,b){"object"==typeof exports?module.exports=b(require("jquery")):"function"==typeof define&&define.amd?define("lastfmfeeds",["jquery"],b):a.lastfmfeeds=b(a.jquery)}(this,function(){function a(){if(console.log("loader"),!jQuery)throw new Error("jQuery is not present, please load it before calling any methods")}function b(a,b){this.element=a,this.settings=b,console.log(b),this.status=null}a.prototype={init:function(a,b,c,d,e){var f=$(a),g={limit:10,size:64,period:"1month",cover:!0,album:!0,artist:!0,plays:!0,date:!0,recent:!0,playing:!0};this.settings=$.extend({},g,e);var h={url:"http://ws.audioscrobbler.com/2.0/?",params:{method:d,format:"json",user:b,api_key:c,limit:this.settings.limit,size:this.settings.size,period:this.settings.period,callback:""}};f.trigger("getjson"),this.loadFeed(f,h.url,h.params)},loadFeed:function(a,c,d){var e=this;$.getJSON(c,d).done(function(c){a.trigger("jsonloaded");var d=new b(a,e.settings);d.setup(c)}).fail(function(){console.log("Error loading JSON feed.")})}};b.prototype={setup:function(a){var b=Object.keys(a)[0];this[b+"Render"](a)},topalbumsRender:function(a){var b=this,d=$("<ol></ol>");$.each(a.topalbums.album,function(a,e){var f=c("album-item",a,b.settings.limit),g=e.artist.name+"-"+e.name+", played "+e.playcount+" times",h=$("<li></li>").attr("title",g).attr("class",f).appendTo(d),i=$("<a></a>").attr("href",e.url).attr("target","_blank").appendTo(h);if(b.settings.cover){$("<img></img>").attr("src",e.image[b.getImageKey(b.settings.size)]["#text"]).attr("class","cover").attr("width",b.settings.size).attr("height",b.settings.size).appendTo(i)}var j=$("<span></span>").attr("class","info").appendTo(i);b.settings.artist&&$('<span class="artist">'+e.artist.name+"</span>").appendTo(j),b.settings.album&&$('<span class="album">'+e.name+"</span>").appendTo(j),b.settings.plays&&$('<span class="plays">'+e.playcount+"<span> Plays</span></span>").appendTo(j),b.element.trigger("attachelement"),d.appendTo(b.element),b.element.trigger("elementattached")})},recenttracksRender:function(){},nowplayingRender:function(){},getImageKey:function(a){var b=34>=a?0:64>=a?1:126>=a?2:3;return b}},String.prototype.cleanup=function(){return this.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")},Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]===a&&(this.splice(b,1),b--);return this};var c=function(a,b,c){var d=0===b?"first":"",e=b===c-1?"last":"",f=[a,d,e],g=f.clean("").join(" ").trim();return g};return new a});