/*!
 * lastfmfeeds v0.1.0 - Last FM Feed JS
 * https://github.com/chriskinch/lastfm_widget
 */
!function(a,b){"object"==typeof exports?module.exports=b(require("jquery")):"function"==typeof define&&define.amd?define("lastfmfeeds",["jquery"],b):a.lastfmfeeds=b(a.jquery)}(this,function(){function a(){if(console.log("loader"),!jQuery)throw new Error("jQuery is not present, please load it before calling any methods")}function b(a,b){this.element=a,this.settings=b,this.status=null}a.prototype={init:function(a,b,c,d,e){var f=$(a),g={limit:10,size:64,period:"1month",cover:!0,album:!0,artist:!0,plays:!0,date:!0,recent:!0,playing:!0};this.settings=$.extend({},g,e);var h="http://ws.audioscrobbler.com/2.0/?",i={method:d,format:"json",user:b,api_key:c,limit:this.settings.limit,size:this.settings.size,period:this.settings.period,callback:""};f.trigger("init"),this.loadFeed(f,h,i,this.settings)},loadFeed:function(a,c,d,e){a.trigger("getjson"),$.getJSON(c,d).done(function(c){a.trigger("jsonloaded");var d=new b(a,e);d.setup(c)}).fail(function(){console.log("Error loading JSON feed.")})}};b.prototype={setup:function(a){var b=Object.keys(a)[0];this[b+"Render"](a)},topalbumsRender:function(a){var b=this,d=$("<ol></ol>");$.each(a.topalbums.album,function(a,e){var f=c("album-item",a,b.settings.limit),g=e.artist.name+"-"+e.name+", played "+e.playcount+" times",h=$("<li></li>").attr("title",g).attr("class",f).appendTo(d),i=$("<a></a>").attr("href",e.url).attr("target","_blank").appendTo(h);if(b.settings.cover){$("<img></img>").attr("src",e.image[b.getImageKey(b.settings.size)]["#text"]).attr("class","cover").attr("width",b.settings.size).attr("height",b.settings.size).appendTo(i)}var j=$("<span></span>").attr("class","info").appendTo(i);b.settings.artist&&$('<span class="artist">'+e.artist.name+"</span>").appendTo(j),b.settings.album&&$('<span class="album">'+e.name+"</span>").appendTo(j),b.settings.plays&&$('<span class="plays">'+e.playcount+"<span> Plays</span></span>").appendTo(j)}),b.element.trigger("attachelement"),d.appendTo(b.element),b.element.trigger("elementattached")},recenttracksRender:function(a){var b=this,e=a.recenttracks.track[0]["@attr"];if(!b.settings.playing&&e)a.recenttracks.track.shift();else{var f=e?"listening":null;b.element.addClass(f)}var g=$("<ol></ol>");$.each(a.recenttracks.track,function(a,f){var h=f.date?", played "+d(f.date):"",i=c("track-item",a,e?Number(b.settings.limit)+1:b.settings.limit),j=f.artist["#text"]+"-"+f.album["#text"]+"-"+f.name+h,k=f["@attr"]?"playing":null,l=$("<li></li>").attr("title",j).attr("class",i).addClass(k).appendTo(g),m=$("<a></a>").attr("href",f.url).attr("target","_blank").appendTo(l);if(b.settings.cover){$("<img></img>").attr("src",f.image[b.getImageKey(b.settings.size)]["#text"]).attr("class","cover").attr("width",b.settings.size).attr("height",b.settings.size).appendTo(m)}var n=$("<span></span>").attr("class","info").appendTo(m);b.settings.artist&&$('<span class="artist">'+f.artist["#text"]+"</span>").appendTo(n),b.settings.album&&$('<span class="album">'+f.album["#text"]+"</span>").appendTo(n),b.settings.artist&&$('<span class="track">'+f.name+"</span>").appendTo(n),b.settings.date&&h&&$('<span class="date">'+h+"</span>").appendTo(n)}),b.element.trigger("attachelement"),g.appendTo(b.element),b.element.trigger("elementattached")},nowplayingRender:function(a){self.element.trigger("jsonloaded");var b=a.recenttracks.track[0]?a.recenttracks.track[0]:a.recenttracks.track,c=b["@attr"]?b["@attr"]:null,d=c?"listening":null;self.element.addClass(d);var e=$("<div></div>"),f=$("<a></a>").attr("href",b.url).attr("target","_blank").appendTo(e);if(self.settings.cover){$("<img></img>").attr("src",b.image[self.config.image_key]["#text"]).attr("class","cover").attr("width",self.settings.size).attr("height",self.settings.size).appendTo(f)}var g=$("<span></span>").attr("class","info").appendTo(f);self.settings.artist&&$('<span class="artist">'+b.artist["#text"]+"</span>").appendTo(g),self.settings.album&&$('<span class="album">'+b.album["#text"]+"</span>").appendTo(g),self.settings.artist&&$('<span class="track">'+b.name+"</span>").appendTo(g),(self.settings.recent||c)&&(self.element.trigger("attachelement"),e.appendTo(self.element),self.element.trigger("elementattached"))},getImageKey:function(a){var b=34>=a?0:64>=a?1:126>=a?2:3;return b}},String.prototype.cleanup=function(){return this.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")},Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]===a&&(this.splice(b,1),b--);return this};var c=function(a,b,c){var d=0===b?"first":"",e=b===c-1?"last":"",f=[a,d,e],g=f.clean("").join(" ").trim();return g},d=function(a){var b=60,c=60*b,d=new Date,e=d.getTime(),f=String(e).substr(0,a.uts.length),g=f-a.uts,h=60>g/b?Math.round(g/b)+" minute":24>g/c?Math.round(g/c)+" hour":null,i=g>1?"s":"",j=h?h+i+" ago":a["#text"];return j};return new a});