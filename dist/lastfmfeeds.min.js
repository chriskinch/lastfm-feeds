/*!
 * lastfmfeeds v0.1.0 - Last FM Feed JS
 * https://github.com/chriskinch/lastfm_widget
 */
!function(a,b){"object"==typeof exports?module.exports=b(require("jquery")):"function"==typeof define&&define.amd?define("lastfmfeeds",["jquery"],b):a.lastfmfeeds=b(a.jquery)}(this,function(){function a(){if(!jQuery)throw new Error("jQuery is not present, please load it before calling any methods")}function b(a,b){this.element=a,this.settings=b,this.status=null}a.prototype={init:function(a,b,c,d,e){var f=$(a),g={limit:10,size:64,period:"1month",cover:!0,album:!0,artist:!0,plays:!0,date:!0,playing:!0};this.settings=$.extend({},g,e);var h="http://ws.audioscrobbler.com/2.0/?",i={method:d,format:"json",user:b,api_key:c,limit:this.settings.limit,size:this.settings.size,period:this.settings.period,callback:""};f.trigger("init"),this.loadFeed(f,h,i,this.settings)},loadFeed:function(a,c,d,e){a.trigger("getjson"),$.getJSON(c,d).done(function(c){a.trigger("jsonloaded");var d=new b(a,e);d.setup(c)}).fail(function(){console.log("Last.fm Feeds: Error loading JSON feed.")})}},b.prototype={setup:function(a){var b=Object.keys(a)[0],c=null;switch(b){case"topalbums":c=a.topalbums.album;break;case"recenttracks":c=a.recenttracks.track;break;default:console.log("Last.fm Feeds: Unrecognized feed.")}this.render(b,c)},render:function(a,b){var e,f,g,h=this,i=null;if("recenttracks"==a){var j=b[0]["@attr"];if(!h.settings.playing&&j)b.shift();else{var k=j?"listening":null;h.element.addClass(k)}}var l=$("<ol></ol>");$.each(b,function(b,k){switch(a){case"topalbums":e=c("item",b,h.settings.limit),g=k.artist.name+"-"+k.name+", played "+k.playcount+" times";break;case"recenttracks":f=k.date?", played "+d(k.date):"",e=c("track-item",b,j?Number(h.settings.limit)+1:h.settings.limit),g=k.artist["#text"]+"-"+k.album["#text"]+"-"+k.name+f,i=k["@attr"]?"playing":null;break;default:console.log("Last.fm Feeds: Unrecognized type.")}var m=$("<li></li>").attr("title",g).attr("class",e).appendTo(l),n=$("<a></a>").attr("href",k.url).attr("target","_blank").appendTo(m);if(h.settings.cover){$("<img></img>").attr("src",k.image[h.getImageKey(h.settings.size)]["#text"]).attr("class","cover").attr("width",h.settings.size).attr("height",h.settings.size).appendTo(n)}var o=$("<span></span>").attr("class","info").appendTo(n);switch(a){case"topalbums":h.settings.artist&&$('<span class="artist">'+k.artist.name+"</span>").appendTo(o),h.settings.album&&$('<span class="album">'+k.name+"</span>").appendTo(o),h.settings.plays&&$('<span class="plays">'+k.playcount+"<span> Plays</span></span>").appendTo(o);break;case"recenttracks":h.settings.artist&&$('<span class="artist">'+k.artist["#text"]+"</span>").appendTo(o),h.settings.album&&$('<span class="album">'+k.album["#text"]+"</span>").appendTo(o),h.settings.artist&&$('<span class="track">'+k.name+"</span>").appendTo(o),h.settings.date&&f&&$('<span class="date">'+f+"</span>").appendTo(o);break;default:console.log("Last.fm Feeds: Unrecognized type.")}}),h.element.trigger("attachelement"),l.appendTo(h.element),h.element.trigger("elementattached")},getImageKey:function(a){var b=34>=a?0:64>=a?1:126>=a?2:3;return b}},String.prototype.cleanup=function(){return this.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")},Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]===a&&(this.splice(b,1),b--);return this};var c=function(a,b,c){var d=0===b?"first":"",e=b===c-1?"last":"",f=[a,d,e],g=f.clean("").join(" ").trim();return g},d=function(a){var b=60,c=60*b,d=new Date,e=d.getTime(),f=String(e).substr(0,a.uts.length),g=f-a.uts,h=60>g/b?Math.round(g/b)+" minute":24>g/c?Math.round(g/c)+" hour":null,i=g>1?"s":"",j=h?h+i+" ago":a["#text"];return j};return new a});