/*!
 * last.fm.feeds v0.1.0 - Last FM Feed JS
 * https://github.com/chriskinch/lastfm_widget
 */
!function(b){b.myLastFM=function(c,d,e,f,g){var h={limit:"10",size:64,period:"1month",cover:!0,album:!0,artist:!0,plays:!0,date:!0,recent:!0,playing:!0},i={},j=this,k=b(c),c=c;j.init=function(){switch(k.trigger("init"),j.settings=b.extend({},h,g),j.config=i,j.config.image_key=l(j.settings.size),j.config.gettopalbums={url:"http://ws.audioscrobbler.com/2.0/?method=user.gettopalbums&format=json&callback=?",params:{user:d,api_key:e,limit:j.settings.limit,size:j.settings.size,period:j.settings.period}},j.config.getrecenttracks={url:"http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&format=json&callback=?",params:{user:d,api_key:e,limit:j.settings.limit}},f){case"gettopalbums":k.trigger("getjson"),j.getJSON(f,j.getTopAlbums);break;case"getrecenttracks":k.trigger("getjson"),j.getJSON(f,j.getRecentTracks);break;case"getnowplaying":k.trigger("getjson"),j.config.getrecenttracks.params.limit=1,j.getJSON("getrecenttracks",j.getNowPlaying);break;default:console.log("No feed specified.")}},j.getJSON=function(a,c){console.log(j.config[a].url),b.getJSON(j.config[a].url,j.config[a].params).done(function(a){c(a)}).fail(function(){console.log("Error loading JSON feed for '"+a+"'.")})},j.getTopAlbums=function(c){k.trigger("jsonloaded"),ol=b("<ol></ol>"),b.each(c.topalbums.album,function(c,d){var e=m("album-item",c,j.settings.limit),f=d.artist.name+"-"+d.name+", played "+d.playcount+" times";li=b("<li></li>").attr("title",f).attr("class",e).appendTo(ol),a=b("<a></a>").attr("href",d.url).attr("target","_blank").appendTo(li),j.settings.cover&&(image=b("<img></img>").attr("src",d.image[j.config.image_key]["#text"]).attr("class","cover").attr("width",j.settings.size).attr("height",j.settings.size).appendTo(a)),info=b("<span></span>").attr("class","info").appendTo(a),j.settings.artist&&b('<span class="artist">'+d.artist.name+"</span>").appendTo(info),j.settings.album&&b('<span class="album">'+d.name+"</span>").appendTo(info),j.settings.plays&&b('<span class="plays">'+d.playcount+"<span> Plays</span></span>").appendTo(info),k.trigger("attachelement"),ol.appendTo(k),k.trigger("elementattached")})},j.getRecentTracks=function(c){k.trigger("jsonloaded");var d=c.recenttracks.track[0]["@attr"];if(!j.settings.playing&&d)c.recenttracks.track.shift();else{var e=d?"listening":null;k.addClass(e)}ol=b("<ol></ol>"),b.each(c.recenttracks.track,function(c,e){var f=e.date?", played "+n(e.date):"",g=m("track-item",c,d?Number(j.settings.limit)+1:j.settings.limit),h=e.artist["#text"]+"-"+e.album["#text"]+"-"+e.name+f,i=e["@attr"]?"playing":null;li=b("<li></li>").attr("title",h).attr("class",g).addClass(i).appendTo(ol),a=b("<a></a>").attr("href",e.url).attr("target","_blank").appendTo(li),j.settings.cover&&(image=b("<img></img>").attr("src",e.image[j.config.image_key]["#text"]).attr("class","cover").attr("width",j.settings.size).attr("height",j.settings.size).appendTo(a)),info=b("<span></span>").attr("class","info").appendTo(a),j.settings.artist&&b('<span class="artist">'+e.artist["#text"]+"</span>").appendTo(info),j.settings.album&&b('<span class="album">'+e.album["#text"]+"</span>").appendTo(info),j.settings.artist&&b('<span class="track">'+e.name+"</span>").appendTo(info),j.settings.date&&f&&b('<span class="date">'+f+"</span>").appendTo(info),k.trigger("attachelement"),ol.appendTo(k),k.trigger("elementattached")})},j.getNowPlaying=function(c){k.trigger("jsonloaded");var d=c.recenttracks.track[0]?c.recenttracks.track[0]:c.recenttracks.track,e=d["@attr"]?d["@attr"]:null,f=e?"listening":null;k.addClass(f),div=b("<div></div>"),a=b("<a></a>").attr("href",d.url).attr("target","_blank").appendTo(div),j.settings.cover&&(image=b("<img></img>").attr("src",d.image[j.config.image_key]["#text"]).attr("class","cover").attr("width",j.settings.size).attr("height",j.settings.size).appendTo(a)),info=b("<span></span>").attr("class","info").appendTo(a),j.settings.artist&&b('<span class="artist">'+d.artist["#text"]+"</span>").appendTo(info),j.settings.album&&b('<span class="album">'+d.album["#text"]+"</span>").appendTo(info),j.settings.artist&&b('<span class="track">'+d.name+"</span>").appendTo(info),(j.settings.recent||e)&&(k.trigger("attachelement"),div.appendTo(k),k.trigger("elementattached"))};var l=function(a){var b=34>=a?0:64>=a?1:126>=a?2:3;return b},m=function(a,b,c){var d=0==b?"first":"",e=b==c-1?"last":"",f=[a,d,e],g=f.clean("").join(" ").trim();return g},n=function(a){var b=60,c=60*b,d=new Date,e=d.getTime(),f=String(e).substr(0,a.uts.length),g=f-a.uts,h=60>g/b?Math.round(g/b)+" minute":24>g/c?Math.round(g/c)+" hour":null,i=g>1?"s":"",j=h?h+i+" ago":a["#text"];return j};j.init()},b.fn.myLastFM=function(a,c,d,e){return this.each(function(){if(!b(this).data("myLastFM")){var f=new b.myLastFM(this,a,c,d,e);b(this).data("pluginName",f)}}),this},String.prototype.cleanup=function(){return this.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")},Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this}}(jQuery,window,document);